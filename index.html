<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Side Projects | 牛码生活</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/marked@12.0.0/lib/marked.umd.min.js"></script>
    <!-- Umami 统计 -->
    <!-- <script async defer data-website-id="YOUR_UMAMI_ID" src="https://YOUR_UMAMI_URL/script.js"></script> -->
</head>
<body>
    <div class="container">
        <header>
            <h1>Side Projects</h1>
            <div class="stats">访问统计：<span id="counter">Loading...</span></div>
        </header>
        <main id="projects-container"></main>
    </div>

    <script>
        const { marked } = window;
        
        marked.use({
            breaks: true,
            gfm: true
        });

        const renderState = {
            isFirstHeading: true
        };

        marked.use({
            extensions: [{
                name: 'project-card',
                level: 'block',
                renderer(token) {
                    if (token.type === 'heading' && token.depth === 3) {
                        const cardStart = renderState.isFirstHeading ? '' : '</article>';
                        renderState.isFirstHeading = false;
                        
                        const linkMatch = token.text.match(/\[([^\]]+)\]\(([^)]+)\)/);
                        let titleHtml;
                        if (linkMatch) {
                            const [, title, url] = linkMatch;
                            titleHtml = `<a href="${url}" target="_blank" class="project-title-link">
                                         <h2 class="project-title">
                                           ${title}
                                           <svg class="github-icon" viewBox="0 0 16 16" width="16" height="16">
                                             <path fill="currentColor" d="M8 0C3.58 0 0 3.58 0 8c0 3.54 2.29 6.53 5.47 7.59.4.07.55-.17.55-.38 0-.19-.01-.82-.01-1.49-2.01.37-2.53-.49-2.69-.94-.09-.23-.48-.94-.82-1.13-.28-.15-.68-.52-.01-.53.63-.01 1.08.58 1.23.82.72 1.21 1.87.87 2.33.66.07-.52.28-.87.51-1.07-1.78-.2-3.64-.89-3.64-3.95 0-.87.31-1.59.82-2.15-.08-.2-.36-1.02.08-2.12 0 0 .67-.21 2.2.82.64-.18 1.32-.27 2-.27.68 0 1.36.09 2 .27 1.53-1.04 2.2-.82 2.2-.82.44 1.1.16 1.92.08 2.12.51.56.82 1.27.82 2.15 0 3.07-1.87 3.75-3.65 3.95.29.25.54.73.54 1.48 0 1.07-.01 1.93-.01 2.2 0 .21.15.46.55.38A8.013 8.013 0 0016 8c0-4.42-3.58-8-8-8z"/>
                                           </svg>
                                         </h2>
                                       </a>`;
                        } else {
                            titleHtml = `<h2 class="project-title">${token.text}</h2>`;
                        }
                        
                        return `${cardStart}<article class="project-card">
                                  <div class="project-header">
                                    ${titleHtml}`;
                    }
                    return false;
                }
            }, {
                name: 'status-progress',
                level: 'block',
                renderer(token) {
                    if (token.type === 'paragraph') {
                        const text = token.text;
                        if (text.includes('**状态**:')) {
                            const statusMatch = text.match(/\*\*状态\*\*: (.+?) \((\d+)%\)/);
                            if (statusMatch) {
                                const [, status, progress] = statusMatch;
                                return `<div class="status-progress">
                                          <span class="status-label">${status}</span>
                                          <div class="progress-bar">
                                            <div class="progress" style="width: ${progress}%"></div>
                                          </div>
                                          <span class="percentage">${progress}%</span>
                                        </div>
                                      </div>`;
                            }
                        } else if (text.includes('**描述**:')) {
                            const descMatch = text.match(/\*\*描述\*\*: (.+)/);
                            if (descMatch) {
                                return `<p class="project-description">${descMatch[1]}</p>`;
                            }
                        }
                    }
                    return false;
                }
            }, {
                name: 'release-notes',
                level: 'block',
                renderer(token) {
                    if (token.type === 'list') {
                        return `<div class="release-notes">
                                  <h3>Release Notes</h3>
                                  <table class="version-table">
                                    <thead>
                                      <tr>
                                        <th>Version</th>
                                        <th>Date</th>
                                        <th>Description</th>
                                      </tr>
                                    </thead>
                                    <tbody>${token.text}</tbody>
                                  </table>
                                </div>`;
                    }
                    return false;
                }
            }, {
                name: 'version-item',
                level: 'inline',
                renderer(token) {
                    if (token.type === 'list_item') {
                        const parts = token.text.split(' | ').map(part => part.trim());
                        if (parts.length === 3) {
                            const [version, date, note] = parts;
                            return `<tr class="version-row">
                                      <td class="version">${version}</td>
                                      <td class="release-date">${date}</td>
                                      <td class="update-desc">${note}</td>
                                    </tr>`;
                        }
                    }
                    return false;
                }
            }]
        });

        // 加载并渲染 Markdown 内容
        async function loadAndRenderMarkdown() {
            try {
                const response = await fetch('README.md');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const mdContent = await response.text();
                
                renderState.isFirstHeading = true;
                
                let html = marked.parse(mdContent);
                if (!html.endsWith('</article>')) {
                    html += '</article>';
                }
                
                document.getElementById('projects-container').innerHTML = html;
            } catch (error) {
                console.error('Error loading markdown:', error);
                document.getElementById('projects-container').innerHTML = 
                    '<p class="error">Error loading project data. Please try again later.</p>';
            }
        }

        document.addEventListener('DOMContentLoaded', loadAndRenderMarkdown);
    </script>
</body>
</html>